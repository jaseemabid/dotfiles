# https://just.systems

# Show available commands
default:
    @just -u --list

# Decode the most recent rayconfig file to JSON
decode:
    #!/usr/bin/env bash
    set -euo pipefail

    # Find most recent input file
    INPUT_FILE=$(eza -1 --sort newest --no-quotes *.rayconfig 2>/dev/null | head -n 1)
    if [ -z "$INPUT_FILE" ]; then
        echo "Error: No .rayconfig files found"
        exit 1
    fi

    # Generate output filename
    OUTPUT_FILE="$(basename "$INPUT_FILE" .rayconfig).json"

    echo "Decoding: $INPUT_FILE"
    echo "Output to: $OUTPUT_FILE"

    # Get password from 1Password
    PASSWORD=$(op read "op://Private/Raycast Settings Export/password")

    # Decrypt, remove 16-byte header, decompress, and pretty print with jq
    openssl enc -d -aes-256-cbc -nosalt -in "$INPUT_FILE" -k "$PASSWORD" 2>/dev/null \
        | tail -c +17 \
        | gunzip \
        | jq . > "$OUTPUT_FILE"

    echo "âœ“ Successfully decoded to $OUTPUT_FILE"
